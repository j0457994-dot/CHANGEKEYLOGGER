name: Build Windows Keylogger

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      
    - name: Install OpenSSL (Quick)
      run: |
        choco install openssl -y --force
        
    - name: Build with MSVC directly
      run: |
        # Create main.cpp with your code
        # (You need to ensure your code is in main.cpp)
        
        # Set environment
        set OPENSSL_INCLUDE="C:\Program Files\OpenSSL-Win64\include"
        set OPENSSL_LIB="C:\Program Files\OpenSSL-Win64\lib"
        
        # Compile
        cl /O2 /MT /EHsc /std:c++17 ^
           /I"%OPENSSL_INCLUDE%" ^
           /DWIN32_LEAN_AND_MEAN /D_WINSOCKAPI_ ^
           main.cpp ^
           /link ^
           /SUBSYSTEM:WINDOWS ^
           /OUT:keylogger.exe ^
           "%OPENSSL_LIB%\libssl.lib" ^
           "%OPENSSL_LIB%\libcrypto.lib" ^
           winhttp.lib user32.lib shell32.lib ole32.lib kernel32.lib ^
           gdi32.lib crypt32.lib iphlpapi.lib ws2_32.lib advapi32.lib
        
        # Copy DLLs
        copy "C:\Program Files\OpenSSL-Win64\bin\libssl-3-x64.dll" .
        copy "C:\Program Files\OpenSSL-Win64\bin\libcrypto-3-x64.dll" .
        
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        name: keylogger-build
        path: |
          keylogger.exe
          *.dll
